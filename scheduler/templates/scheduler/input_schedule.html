{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚·ãƒ•ãƒˆä¸€æ‹¬æå‡º</title>
    <style>
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .calendar-cell {
            height: 80px;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }
        .calendar-cell:hover {
            background-color: #f8f9fa;
        }
        /* é¸æŠã•ã‚ŒãŸçŠ¶æ…‹ */
        .selected {
            background-color: #d1e7dd !important; /* ç·‘è‰² */
            border: 2px solid #198754;
        }
        /* æ—¥ä»˜ã®æ•°å­— */
        .date-num {
            position: absolute;
            top: 5px;
            left: 5px;
            font-weight: bold;
        }
        /* éš ã—ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆè¦‹ãˆãªãã™ã‚‹ï¼‰ */
        .date-checkbox {
            display: none;
        }
    </style>
</head>
<body class="container mt-4">

    <h2 class="mb-4">ğŸ“… {{ year }}å¹´{{ month }}æœˆã®ã‚·ãƒ•ãƒˆæå‡º</h2>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <form method="post">
        {% csrf_token %}
        
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">
                1. å‡ºå‹¤æ™‚é–“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">ğŸ¢ å¹³æ—¥ã®å‡ºå‹¤æ™‚é–“</label>
                        <select name="weekday_start_time" class="form-select">
                            <option value="17" selected>17:00</option>
                            <option value="18">18:00</option>
                        </select>
                        <div class="form-text">æœˆã€œé‡‘ï¼ˆç¥æ—¥é™¤ãï¼‰ã«é©ç”¨ã•ã‚Œã¾ã™</div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">ğŸ‰ åœŸæ—¥ç¥ã®å‡ºå‹¤æ™‚é–“</label>
                        <select name="weekend_start_time" class="form-select">
                            <option value="11" selected>æ˜¼ (11:30)</option> 
                            <option value="16">å¤•æ–¹ (16:00)</option>
                            <option value="17">å¤•æ–¹ (17:00)</option>
                        </select>
                        <div class="form-text">åœŸãƒ»æ—¥ãƒ»ç¥æ—¥ã«é©ç”¨ã•ã‚Œã¾ã™</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-secondary py-2 px-3 mb-4" style="font-size: 0.9rem;">
            â„¹ï¸ é€€å‹¤æ™‚é–“ã¯ <strong>ã€ŒãŠã¾ã‹ã›ï¼ˆAIåˆ¤å®šï¼‰ã€</strong> ã¨ã—ã¦æå‡ºã•ã‚Œã¾ã™ã€‚
        </div>

        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h5>2. å‡ºå‹¤ã™ã‚‹æ—¥ã‚’ã‚¿ãƒƒãƒ—</h5>
                <table class="table table-bordered text-center mb-0">
                    <thead class="table-dark">
                        <tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr>
                    </thead>
                    <tbody>
                        {% for week in month_days %}
                        <tr>
                            {% for day in week %}
                                {% if day.month == month %}
                                    <td class="calendar-cell" onclick="toggleDate(this)">
                                        <span class="date-num">{{ day.day }}</span>
                                        <input type="checkbox" name="dates" value="{{ day|date:'Y-m-d' }}" class="date-checkbox">
                                        <span class="badge bg-success mt-4 d-none check-mark">å‡ºå‹¤</span>
                                    </td>
                                {% else %}
                                    <td class="bg-light text-muted"></td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100 btn-lg py-3">
            ã¾ã¨ã‚ã¦æå‡ºã™ã‚‹
        </button>
    </form>

    <script>
        // æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®å‹•ä½œ
        function toggleDate(cell) {
            const checkbox = cell.querySelector('.date-checkbox');
            const badge = cell.querySelector('.check-mark');
            
            // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’åè»¢
            checkbox.checked = !checkbox.checked;
            
            // è¦‹ãŸç›®ã‚’åˆ‡ã‚Šæ›¿ãˆ
            if (checkbox.checked) {
                cell.classList.add('selected');
                badge.classList.remove('d-none');
            } else {
                cell.classList.remove('selected');
                badge.classList.add('d-none');
            }
        }
    </script>

</body>
</html>